#!/bin/bash

releases=$(helm ls \
  | tail -n +2 \
  | sort \
  | awk '{print $1 "\t\t\t" $4 "\t\t" $5}')

release=$(printf "quit\n${releases}" \
  | fzf --header='Active Helm releases' \
  | awk '{print $1}')

if [ "${release}" = "quit" ]; then
  echo 'No release selected, exiting...'
  exit 1
fi

url=$(helm get values "${release}" | yq .ci.pipeline.url)
open "${url}"
